<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.base.sbc.module.patternmaking.mapper.PatternMakingMapper">
    <!--
        打版管理
        创建人：lxl
        邮箱：lxl.fml@gmail.com
        创建时间：2023-5-29 13:33:05
        版本号：1.0
      -->

    <!-- ***********************自定义方法区 不替换的区域【other_start】***************************************** -->


    <!-- ***********************自定义方法区 不替换的区域【other_end】******************************************** -->
    <select id="technologyCenterTaskList"
            resultType="com.base.sbc.module.patternmaking.vo.TechnologyCenterTaskVo">
        SELECT
        p.id,
        s.design_no,
        s.style_pic,
        s.category_name,
        s.brand,
        s.year,
        s.month,
        s.season,
        s.band_code,
        s.style_name,
        p.design_send_date,
        p.prm_send_date,
        p.prm_send_status,
        p.urgency,
        p.planning_season_id,
        p.pattern_design_id,
        p.break_off_sample,
        p.break_off_pattern,
        p.pattern_design_name
        FROM
        t_pattern_making p,
        t_sample_design s
        where p.sample_design_id = s.id and p.design_send_status='1'
        <if test="ew.customSqlSegment != null and ew.customSqlSegment != ''">
            ${ ew.customSqlSegment.startsWith("WHERE")?ew.customSqlSegment.replace("WHERE","AND "):ew.customSqlSegment}
        </if>
    </select>
    <select id="getPatternDesignSampleTypeCount"
            resultType="com.base.sbc.module.patternmaking.vo.PatternDesignSampleTypeQtyVo">
        SELECT
        pattern_design_id ,sample_type ,count(id) as quantity
        FROM
        `t_pattern_making`
        WHERE

        del_flag =0
        <if test="ew.customSqlSegment != null and ew.customSqlSegment != ''">
            ${ ew.customSqlSegment.startsWith("WHERE")?ew.customSqlSegment.replace("WHERE","AND "):ew.customSqlSegment}
        </if>
        group by pattern_design_id ,sample_type

    </select>
    <select id="patternMakingTaskList"
            resultType="com.base.sbc.module.patternmaking.vo.PatternMakingTaskListVo">
        SELECT
        p.id,
        s.design_no,
        s.style_pic,
        s.category_name,
        s.brand,
        s.year,
        s.month,
        s.season,
        s.band_code,
        s.style_name,
        s.designer,
        s.designer_id,
        p.code,
        p.sample_type,
        p.design_send_date,
        p.prm_send_date,
        p.prm_send_status,
        p.urgency,
        p.node,
        p.status,
        p.sgl_kitting,
        p.technician_kitting,
        p.sort,
        p.suspend,
        p.planning_season_id,
        p.pattern_design_id,
        p.stitcher,
        p.stitcher_id,
        p.cutter_name,
        p.cutter_id,
        p.break_off_sample,
        p.break_off_pattern,
        p.update_date,
        p.pattern_design_name
        FROM
        t_pattern_making p,
        t_sample_design s
        where p.sample_design_id = s.id
        and p.design_send_status='1'
        and p.prm_send_status='1'
        and p.del_flag &lt;&gt; '1'
        and s.del_flag &lt;&gt; '1'

        <if test="ew.customSqlSegment != null and ew.customSqlSegment != ''">
            ${ ew.customSqlSegment.startsWith("WHERE")?ew.customSqlSegment.replace("WHERE","AND "):ew.customSqlSegment}
        </if>


    </select>
    <select id="sampleBoardList" resultType="com.base.sbc.module.patternmaking.vo.SampleBoardVo">
        SELECT
        p.id AS patternMakingId,
        s.*,
        p.*
        FROM
        t_sample_design s
        LEFT JOIN t_pattern_making p ON ( s.id = p.sample_design_id )
        where
        p.del_flag &lt;&gt; '1'
        and s.del_flag &lt;&gt; '1'
        <if test="ew.customSqlSegment != null and ew.customSqlSegment != ''">
            ${ ew.customSqlSegment.startsWith("WHERE")?ew.customSqlSegment.replace("WHERE","AND "):ew.customSqlSegment}
        </if>
    </select>
    <select id="getAllPatternDesignList" resultType="com.base.sbc.module.sample.vo.SampleUserVo">
        select DISTINCT pattern_design_id as user_id, pattern_design_name as name
        from t_pattern_making s
        where company_code = #{companyCode}
          and pattern_design_id is not null

    </select>
    <select id="nsCount" resultType="java.util.Map">
        select CONCAT(node, '-', status) as nodeStatus, count(1) as total
        from t_pattern_making ${ew.customSqlSegment}
        group by node, status

    </select>
    <select id="findBySampleDesignId" resultType="com.base.sbc.module.patternmaking.vo.PatternMakingListVo">
        select m.*,d.product_sizes  ,d.pat_diff as sd_pat_diff
        from t_pattern_making m  join t_sample_design d on (m.sample_design_id=d.id)  ${ew.customSqlSegment}
    </select>

    <select id="getAllList" resultType="com.base.sbc.module.patternmaking.vo.PatternMakingForSampleVo">
        SELECT pk.id, pk.`code`, pk.sample_type, sd.style_name, sd.design_no, sd.category_name, sd.category_ids,
            ps.id AS seasonId, ps.season, sd.designer, sd.designer_id, sd.pattern_design_id, sd.pattern_design_name,
            pk.sample_design_id
        FROM t_pattern_making pk
        JOIN t_sample_design sd ON sd.id = pk.sample_design_id
        JOIN t_planning_season ps ON ps.id = pk.planning_season_id
        ${ew.customSqlSegment}
    </select>
</mapper>

